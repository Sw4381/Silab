<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ì•ˆ ì§€ëŠ¥ ì—°êµ¬ì‹¤ - í”„ë¡œì íŠ¸</title>
    <!-- ì˜¬ë°”ë¥¸ CSS ë¡œë”© ìˆœì„œ ì ìš© -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="projects.css">

        <!-- ê¸°ì¡´ Firestore SDK ëŒ€ì‹  Realtime Database SDK ì‚¬ìš© -->
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    
    
</head>
<body>


           
    <!-- í—¤ë” -->
    <header class="navbar">
        <div class="logo">
            <a href="index.html">
                <img class="logo-picture" src="./image.png" alt="ë³´ì•ˆ ì§€ëŠ¥ ì—°êµ¬ì‹¤ ë¡œê³ ">
                </a>
            </div>
        <nav class="menu">
            <a href="index.html"><i class="fas fa-graduation-cap"></i> Home</a>
            <a href="./members.html"><i class="fas fa-users"></i> Members</a>
            <a href="./projects.html" class="active"><i class="fas fa-file-alt"></i> Projects</a>
            <a href="./Publication.html"><i class="fas fa-copy"></i> Publications</a>
            <a href="./photo.html"><i class="fas fa-image"></i> Other Activities</a>
        </nav>
        </div>

        <div class="auth-section">
            <div class="user-info" id="userInfo" style="display: none;">
                <i class="fas fa-user"></i>
                <span id="userName"></span>
            </div>
            <button class="login-btn" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i>
                ë¡œê·¸ì¸
            </button>
            <button class="logout-btn" id="logoutBtn" style="display: none;">
                <i class="fas fa-sign-out-alt"></i>
                ë¡œê·¸ì•„ì›ƒ
            </button>
        </div>

    </header>


        <!-- Firebase ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div id="loginModal" class="login-modal">
        <div class="login-modal-content">
            <span class="login-close" id="loginClose">&times;</span>
            <form class="login-form" id="loginForm">
                <h2><i class="fab fa-firebase"></i> ì—°êµ¬ì‹¤ ë¡œê·¸ì¸</h2>
                <div class="form-group">
                    <label for="email">ì´ë©”ì¼</label>
                    <input type="email" id="email" name="email" required 
                           placeholder="example@gachon.ac.kr">
                </div>
                <div class="form-group">
                    <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-submit">
                    <i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸
                </button>
                <div class="login-help">
                    ì—°êµ¬ì‹¤ ë©¤ë²„ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê³„ì •ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
                </div>
            </form>
        </div>
    </div>




    <div class="container">

        <!-- ê´€ë¦¬ì íŒ¨ë„ -->
        <div class="admin-panel" id="adminPanel">
            <h3><i class="fas fa-tools"></i> í”„ë¡œì íŠ¸ ê´€ë¦¬</h3>
            <div class="admin-buttons">
                <button class="admin-btn" id="addProjectBtn">
                    <i class="fas fa-plus"></i>
                    ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€
                </button>
                <button class="admin-btn delete" id="toggleDeleteMode">
                    <i class="fas fa-trash"></i>
                    ì‚­ì œ ëª¨ë“œ í† ê¸€
                </button>
            </div>
        </div>

        <!-- í”„ë¡œì íŠ¸ ì¶”ê°€ í¼ -->
<!-- í”„ë¡œì íŠ¸ ì¶”ê°€ í¼ -->
<div class="add-project-form" id="addProjectForm">
    <h4><i class="fas fa-plus-circle"></i> ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€</h4>
    <form id="projectForm">
        <div class="form-row">
            <div class="form-group">
                <label for="projectName">í”„ë¡œì íŠ¸ëª…</label>
                <input type="text" id="projectName" name="projectName" required>
            </div>
            <div class="form-group">
                <label for="projectPeriod">ì—°êµ¬ê¸°ê°„</label>
                <input type="text" id="projectPeriod" name="projectPeriod" 
                       placeholder="ì˜ˆ: 2024.01 ~ 2025.12" required>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="projectFunding">Funding</label>
                <input type="text" id="projectFunding" name="projectFunding" required>
            </div>
            <div class="form-group">
                <label for="projectType">í”„ë¡œì íŠ¸ íƒ€ì…</label>
                <select id="projectType" name="projectType">
                    <option value="current">í˜„ì¬ ì§„í–‰ ì¤‘</option>
                    <option value="past">ê³¼ê±° í”„ë¡œì íŠ¸</option>
                </select>
            </div>
        </div>
        <!-- ìƒˆë¡œ ì¶”ê°€: ìœ„ì¹˜ ì„ íƒ -->
        <div class="form-row">
            <div class="form-group">
                <label for="insertPosition">ì¶”ê°€ ìœ„ì¹˜</label>
                <select id="insertPosition" name="insertPosition">
                    <option value="end">ë§¨ ëì— ì¶”ê°€</option>
                    <option value="beginning">ë§¨ ì•ì— ì¶”ê°€</option>
                    <option value="specific">íŠ¹ì • ìœ„ì¹˜ì— ì¶”ê°€</option>
                </select>
            </div>
            <div class="form-group" id="specificPositionGroup" style="display: none;">
                <label for="specificPosition">ìœ„ì¹˜ ë²ˆí˜¸</label>
                <input type="number" id="specificPosition" name="specificPosition" 
                       min="0" placeholder="0ë¶€í„° ì‹œì‘ (0=ì²«ë²ˆì§¸)">
            </div>
        </div>
        <div class="form-group">
            <label for="projectDesc">ì£¼ìš”ë‚´ìš©</label>
            <textarea id="projectDesc" name="projectDesc" required></textarea>
        </div>
        <div class="form-buttons">
            <button type="button" class="cancel-btn" id="cancelAddProject">ì·¨ì†Œ</button>
            <button type="submit" class="submit-btn">
                <i class="fas fa-save"></i> ì €ì¥
            </button>
        </div>
    </form>
</div>


        <!-- í”„ë¡œì íŠ¸ ì†Œê°œ ì„¹ì…˜ -->
        <div class="page-header hidden">
            <h1>Projects</h1>
            <p>ë³´ì•ˆì§€ëŠ¥ì—°êµ¬ì‹¤ì€ ë‹¤ì–‘í•œ ë³´ì•ˆ ê´€ë ¨ ì—°êµ¬ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <!-- í˜„ì¬ ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ ì„¹ì…˜ -->
        <section class="project-section hidden">
            <h2 class="section-title"><i class="fas fa-tasks"></i> Current Projects</h2>
            
            <div class="project-list">
                <!-- í”„ë¡œì íŠ¸ 1 -->
            </div>

        </section>

        <!-- ê³¼ê±° í”„ë¡œì íŠ¸ ì„¹ì…˜ -->
        <section class="project-section past-projects hidden">
            <h2 class="section-title"><i class="fas fa-history"></i> Past Projects</h2>
            
            <div class="project-list past">
        
            </div>
        </section>

        <!-- í‘¸í„° -->
        <footer>
            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <a href="mailto:kinjecs0@gmail.com">kinjecs0@gmail.com</a>
                </div>
                <div class="divider"></div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>ê°€ì²œëŒ€í•™êµ ìŠ¤ë§ˆíŠ¸ë³´ì•ˆí•™ê³¼</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->

<script>
const firebaseConfig = {
    apiKey: "AIzaSyC1HQOuTGQ5IaLQiSRitcM2NsaYxtAmDQk",
    authDomain: "security-lab-projects-4d1cb.firebaseapp.com",
    databaseURL: "https://security-lab-projects-4d1cb-default-rtdb.firebaseio.com",
    projectId: "security-lab-projects-4d1cb",
    storageBucket: "security-lab-projects-4d1cb.firebasestorage.app",
    messagingSenderId: "1075416037204",
    appId: "1:1075416037204:web:89db47137971d40485bac1",
    measurementId: "G-JH2LH2CS3K"
};

// ==================== ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ ====================
let app, auth, database;
let currentUser = null;
let deleteMode = false;

// ==================== í—ˆìš©ëœ ì‚¬ìš©ì ëª©ë¡ ====================
const ALLOWED_USERS = ['kinjecs0@gmail.com'];

// ==================== DOM ìš”ì†Œë“¤ ====================
let loginBtn, logoutBtn, loginModal, loginClose, loginForm;
let userInfo, userName, adminPanel, addProjectBtn, addProjectForm;
let projectForm, cancelAddProject, toggleDeleteMode;

// ==================== ê¸°ë³¸ í•¨ìˆ˜ë“¤ ====================
function deleteProject(projectId) {
    if (!currentUser || !deleteMode) {
        showAlert('ì‚­ì œ ëª¨ë“œê°€ í™œì„±í™”ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
        return;
    }
    
    if (!confirm('ì •ë§ë¡œ ì´ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    const projectElement = document.querySelector(`[data-project-id="${projectId}"]`);
    if (projectElement) {
        projectElement.remove();
        showAlert('í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
    } else {
        showAlert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
    }
}

function openModal(projectId) {
    const modal = document.getElementById(projectId + 'Modal');
    if (modal) {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }
}

function closeModal(projectId) {
    const modal = document.getElementById(projectId + 'Modal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

function showAlert(message, type) {
    const alert = document.createElement('div');
    alert.className = `alert ${type}`;
    alert.textContent = message;
    alert.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 1002; max-width: 400px;
        padding: 15px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        animation: slideInRight 0.3s ease;
    `;
    
    if (type === 'success') {
        alert.style.background = '#d4edda';
        alert.style.color = '#155724';
        alert.style.border = '1px solid #c3e6cb';
    } else if (type === 'error') {
        alert.style.background = '#f8d7da';
        alert.style.color = '#721c24';
        alert.style.border = '1px solid #f5c6cb';
    } else if (type === 'warning') {
        alert.style.background = '#fff3cd';
        alert.style.color = '#856404';
        alert.style.border = '1px solid #ffeaa7';
    }
    
    document.body.appendChild(alert);
    setTimeout(() => alert.remove(), 3000);
}

// ==================== Firebase ê´€ë ¨ í•¨ìˆ˜ë“¤ ====================
async function loadProjectsFromRealtimeDB() {
    if (!database) {
        console.error('Realtime Databaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
    }
    
    try {
        console.log('ğŸ”„ Realtime Databaseì—ì„œ í”„ë¡œì íŠ¸ ë¡œë“œ ì¤‘...');
        
        // current projects ë¡œë“œ
        const currentRef = database.ref('current projects');
        const currentSnapshot = await currentRef.once('value');
        const currentData = currentSnapshot.val() || {};
        
        // past projects ë¡œë“œ
        const pastRef = database.ref('past projects');
        const pastSnapshot = await pastRef.once('value');
        const pastData = pastSnapshot.val() || {};
        
        console.log('ğŸ“Š í˜„ì¬ í”„ë¡œì íŠ¸ Raw ë°ì´í„°:', currentData);
        console.log('ğŸ“Š ê³¼ê±° í”„ë¡œì íŠ¸ Raw ë°ì´í„°:', pastData);
        
        // ê¸°ì¡´ Firebase í”„ë¡œì íŠ¸ ì œê±°
        const dynamicProjects = document.querySelectorAll('[data-firebase="true"]');
        dynamicProjects.forEach(item => item.remove());
        
        let currentCount = 0;
        let pastCount = 0;
        
        // í˜„ì¬ í”„ë¡œì íŠ¸ ì²˜ë¦¬
        if (currentData && typeof currentData === 'object') {
            Object.keys(currentData).forEach((firebaseKey, index) => {
                const project = currentData[firebaseKey];
                if (project && project.name) {
                    project.id = `current_${index}`;
                    project.firebaseKey = firebaseKey; // Firebase í‚¤ ì €ì¥
                    project.type = 'current';
                    addProjectToDOM(project);
                    currentCount++;
                }
            });
        }
        
        // ê³¼ê±° í”„ë¡œì íŠ¸ ì²˜ë¦¬
        if (pastData && typeof pastData === 'object') {
            Object.keys(pastData).forEach((firebaseKey, index) => {
                const project = pastData[firebaseKey];
                if (project && project.name) {
                    project.id = `past_${index}`;
                    project.firebaseKey = firebaseKey; // Firebase í‚¤ ì €ì¥
                    project.type = 'past';
                    addProjectToDOM(project);
                    pastCount++;
                }
            });
        }
        
        console.log('âœ… í”„ë¡œì íŠ¸ ë¡œë“œ ì™„ë£Œ');
        
    } catch (error) {
        console.error('âŒ í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
    }
}

function addProjectToDOM(project) {
    console.log('ğŸ¯ DOMì— í”„ë¡œì íŠ¸ ì¶”ê°€:', project.name);
    
    let container;
    if (project.type === 'current') {
        container = document.querySelector('.project-list:not(.past)');
    } else {
        container = document.querySelector('.project-list.past .more-projects');
        if (!container) {
            container = document.querySelector('.project-list.past');
        }
    }
    
    if (container) {
        const projectElement = createProjectElement(project);
        container.appendChild(projectElement);
        console.log('âœ… DOM ì¶”ê°€ ì„±ê³µ');
    } else {
        console.error('âŒ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', project.type);
    }
}

function createProjectElement(project) {
    const projectDiv = document.createElement('div');
    projectDiv.className = project.type === 'current' ? 'project-item' : 'project-item past-item';
    projectDiv.setAttribute('data-project-id', project.id);
    projectDiv.setAttribute('data-firebase', 'true');
    
    // Firebase í‚¤ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì¸ë±ìŠ¤ ì‚¬ìš©
    const deleteId = project.firebaseKey || project.id;
    
    projectDiv.innerHTML = `
        <div class="project-content">
            <div class="project-header">
                <div class="project-info">
                    <h3 class="project-name">${project.name}</h3>
                    <p class="project-period">
                        <i class="far fa-calendar-alt"></i> ì—°êµ¬ê¸°ê°„: ${project.period}
                    </p>
                    <p class="project-funding">
                        <strong>Funding:</strong> ${project.funding}
                    </p>
                    ${project.description ? `
                        <p class="project-desc">
                            <strong>ì£¼ìš”ë‚´ìš©:</strong> ${project.description}
                        </p>
                    ` : ''}
                </div>
                <div class="project-actions" style="display: none;">
                    <button class="delete-project-btn" onclick="deleteFirebaseProject('${deleteId}', '${project.type}')">
                        <i class="fas fa-trash"></i> ì‚­ì œ
                    </button>
                </div>
            </div>
        </div>
    `;
    
    return projectDiv;
}

async function addProjectToRealtimeDB(projectData) {
    try {
        const insertPosition = document.getElementById('insertPosition').value;
        const specificPosition = parseInt(document.getElementById('specificPosition').value) || 0;
        
        const refPath = projectData.type === 'current' ? 'current projects' : 'past projects';
        const ref = database.ref(refPath);
        
        // í˜„ì¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const snapshot = await ref.once('value');
        const currentData = snapshot.val() || {};
        const dataArray = Object.keys(currentData).map(key => ({
            key: key,
            ...currentData[key]
        }));
        
        console.log('í˜„ì¬ ë°ì´í„° ë°°ì—´:', dataArray);
        
        if (insertPosition === 'end') {
            // ë§¨ ëì— ì¶”ê°€ (ê¸°ë³¸ push ë°©ì‹)
            await ref.push(projectData);
            showAlert('í”„ë¡œì íŠ¸ê°€ ë§¨ ëì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
        } else if (insertPosition === 'beginning') {
            // ë§¨ ì•ì— ì¶”ê°€
            await insertProjectAtPosition(refPath, projectData, 0, dataArray);
            showAlert('í”„ë¡œì íŠ¸ê°€ ë§¨ ì•ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
        } else if (insertPosition === 'specific') {
            // íŠ¹ì • ìœ„ì¹˜ì— ì¶”ê°€
            const position = Math.max(0, Math.min(specificPosition, dataArray.length));
            await insertProjectAtPosition(refPath, projectData, position, dataArray);
            showAlert(`í”„ë¡œì íŠ¸ê°€ ${position + 1}ë²ˆì§¸ ìœ„ì¹˜ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }
        
        // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        setTimeout(() => {
            loadProjectsFromRealtimeDB();
        }, 1000);
        
    } catch (error) {
        console.error('í”„ë¡œì íŠ¸ ì¶”ê°€ ì‹¤íŒ¨:', error);
        showAlert('í”„ë¡œì íŠ¸ ì¶”ê°€ ì‹¤íŒ¨: ' + error.message, 'error');
    }
}


async function insertProjectAtPosition(refPath, newProject, position, currentDataArray) {
    try {
        // ì „ì²´ ë°ì´í„° ë°°ì—´ ì¬êµ¬ì„±
        const newDataArray = [...currentDataArray];
        newDataArray.splice(position, 0, newProject);
        
        // ê¸°ì¡´ ë°ì´í„° ëª¨ë‘ ì‚­ì œ
        await database.ref(refPath).remove();
        
        // ìƒˆë¡œìš´ ìˆœì„œë¡œ ë°ì´í„° ë‹¤ì‹œ ì¶”ê°€
        const ref = database.ref(refPath);
        for (let i = 0; i < newDataArray.length; i++) {
            const item = { ...newDataArray[i] };
            delete item.key; // Firebase í‚¤ ì œê±°
            await ref.push(item);
        }
        
        console.log(`âœ… ${position + 1}ë²ˆì§¸ ìœ„ì¹˜ì— í”„ë¡œì íŠ¸ ì¶”ê°€ ì™„ë£Œ`);
        
    } catch (error) {
        console.error('ìœ„ì¹˜ë³„ ì¶”ê°€ ì‹¤íŒ¨:', error);
        throw error;
    }
}


window.deleteFirebaseProject = async function(projectId, projectType) {
    if (!currentUser || !deleteMode) {
        showAlert('ì‚­ì œ ëª¨ë“œê°€ í™œì„±í™”ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
        return;
    }
    
    if (!confirm('ì •ë§ë¡œ ì´ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    
    try {
        console.log('ğŸ—‘ï¸ í”„ë¡œì íŠ¸ ì‚­ì œ ì‹œë„:', projectId, projectType);
        
        // Firebase í‚¤ì¸ì§€ ì¸ë±ìŠ¤ì¸ì§€ í™•ì¸
        let refPath;
        if (projectId.includes('current_') || projectId.includes('past_')) {
            // ê¸°ì¡´ ì¸ë±ìŠ¤ ë°©ì‹ (ì •ì  ë°ì´í„°)
            const [type, index] = projectId.split('_');
            refPath = `${type === 'current' ? 'current projects' : 'past projects'}/${index}`;
        } else {
            // Firebase í‚¤ ë°©ì‹ (ë™ì  ë°ì´í„°)
            refPath = `${projectType === 'current' ? 'current projects' : 'past projects'}/${projectId}`;
        }
        
        console.log('ğŸ¯ ì‚­ì œ ê²½ë¡œ:', refPath);
        
        await database.ref(refPath).remove();
        showAlert('í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        
        // DOMì—ì„œë„ ì œê±°
        const projectElement = document.querySelector(`[data-project-id*="${projectId}"]`);
        if (projectElement) {
            projectElement.remove();
        }
        
        // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        setTimeout(() => {
            loadProjectsFromRealtimeDB();
        }, 500);
        
    } catch (error) {
        console.error('í”„ë¡œì íŠ¸ ì‚­ì œ ì‹¤íŒ¨:', error);
        showAlert('í”„ë¡œì íŠ¸ ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
    }
};

// ==================== ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜ë“¤ ====================
async function loginUser(email, password) {
    if (!ALLOWED_USERS.includes(email)) {
        throw new Error('ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ì—°êµ¬ì‹¤ ë©¤ë²„ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    }
    
    try {
        const result = await auth.signInWithEmailAndPassword(email, password);
        return result;
    } catch (error) {
        if (error.code === 'auth/user-not-found') {
            return await auth.createUserWithEmailAndPassword(email, password);
        } else if (error.code === 'auth/wrong-password') {
            throw new Error('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
        } else if (error.code === 'auth/invalid-email') {
            throw new Error('ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }
        throw error;
    }
}

async function logoutUser() {
    await auth.signOut();
    currentUser = null;
    updateAuthUI();
    showAlert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
}

function updateAuthUI() {
    if (currentUser) {
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'flex';
        userInfo.style.display = 'flex';
        userName.textContent = currentUser.email;
        adminPanel.style.display = 'block';
    } else {
        loginBtn.style.display = 'flex';
        logoutBtn.style.display = 'none';
        userInfo.style.display = 'none';
        adminPanel.style.display = 'none';
        addProjectForm.style.display = 'none';
        deleteMode = false;
    }
    updateDeleteButtonsVisibility();
}

function updateDeleteButtonsVisibility() {
    const deleteButtons = document.querySelectorAll('.project-actions');
    deleteButtons.forEach(button => {
        button.style.display = (currentUser && deleteMode) ? 'block' : 'none';
    });
}

// ==================== ë©”ì¸ ì´ˆê¸°í™” ====================
document.addEventListener("DOMContentLoaded", function() {
    console.log('ğŸ”¥ Firebase ì´ˆê¸°í™” ì‹œì‘...');
    
    // DOM ìš”ì†Œë“¤ ì´ˆê¸°í™”
    loginBtn = document.getElementById('loginBtn');
    logoutBtn = document.getElementById('logoutBtn');
    loginModal = document.getElementById('loginModal');
    loginClose = document.getElementById('loginClose');
    loginForm = document.getElementById('loginForm');
    userInfo = document.getElementById('userInfo');
    userName = document.getElementById('userName');
    adminPanel = document.getElementById('adminPanel');
    addProjectBtn = document.getElementById('addProjectBtn');
    addProjectForm = document.getElementById('addProjectForm');
    projectForm = document.getElementById('projectForm');
    cancelAddProject = document.getElementById('cancelAddProject');
    toggleDeleteMode = document.getElementById('toggleDeleteMode');
    
    // Firebase ì´ˆê¸°í™”
    try {
        app = firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        database = firebase.database();
        
        console.log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ');
        
        // ì¸ì¦ ìƒíƒœ ë³€í™” ë¦¬ìŠ¤ë„ˆ
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            updateAuthUI();
            
            if (user) {
                console.log('âœ… ì‚¬ìš©ì ë¡œê·¸ì¸:', user.email);
                // ë¡œê·¸ì¸ í›„ ë°ì´í„° ë¡œë“œ
                loadProjectsFromRealtimeDB();
            } else {
                console.log('â„¹ï¸ ì‚¬ìš©ì ë¯¸ë¡œê·¸ì¸');
                // ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œë„ ë°ì´í„° ë¡œë“œ (ì½ê¸° ê¶Œí•œì´ ìˆëŠ” ê²½ìš°)
                loadProjectsFromRealtimeDB();
            }
        });
        
    } catch (error) {
        console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        showAlert('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message, 'error');
    }
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤ ì„¤ì •
    setupEventListeners();
    
    // ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜
    setupScrollAnimation();
    
    // ë” ë³´ê¸° ë²„íŠ¼
    setupMoreButton();
});

function setupEventListeners() {
        // ìœ„ì¹˜ ì„ íƒ ì„¤ì • ì¶”ê°€
    setupPositionSelector();
    
    // í”„ë¡œì íŠ¸ íƒ€ì… ë³€ê²½ ì‹œ ìœ„ì¹˜ ì˜µì…˜ ì—…ë°ì´íŠ¸
    const projectTypeSelect = document.getElementById('projectType');
    if (projectTypeSelect) {
        projectTypeSelect.addEventListener('change', () => {
            const insertPosition = document.getElementById('insertPosition');
            if (insertPosition && insertPosition.value === 'specific') {
                updatePositionOptions();
            }
        });
    }
    
    // ë¡œê·¸ì¸ ê´€ë ¨
    loginBtn.addEventListener('click', () => {
        loginModal.style.display = 'block';
    });
    
    loginClose.addEventListener('click', () => {
        loginModal.style.display = 'none';
    });
    
    logoutBtn.addEventListener('click', logoutUser);
    
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        try {
            const result = await loginUser(email, password);
            currentUser = result.user;
            updateAuthUI();
            showAlert('ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
            loginModal.style.display = 'none';
            loginForm.reset();
        } catch (error) {
            console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
            showAlert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message, 'error');
        }
    });
    loginBtn.addEventListener('click', () => {
        loginModal.style.display = 'block';
    });

    // í”„ë¡œì íŠ¸ ê´€ë¦¬
    addProjectBtn.addEventListener('click', () => {
        addProjectForm.style.display = addProjectForm.style.display === 'none' ? 'block' : 'none';
    });
    
    cancelAddProject.addEventListener('click', () => {
        addProjectForm.style.display = 'none';
        projectForm.reset();
    });
    
    projectForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(projectForm);
        
        const projectData = {
            name: formData.get('projectName'),
            period: formData.get('projectPeriod'),
            funding: formData.get('projectFunding'),
            description: formData.get('projectDesc'),
            type: formData.get('projectType')
        };
        
        await addProjectToRealtimeDB(projectData);
        addProjectForm.style.display = 'none';
        projectForm.reset();
    });
    
    toggleDeleteMode.addEventListener('click', () => {
        deleteMode = !deleteMode;
        updateDeleteButtonsVisibility();
        showAlert(deleteMode ? 'ì‚­ì œ ëª¨ë“œ í™œì„±í™”' : 'ì‚­ì œ ëª¨ë“œ ë¹„í™œì„±í™”', 'success');
    });
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.addEventListener('click', (e) => {
        if (e.target === loginModal) {
            loginModal.style.display = 'none';
        }
    });





}

function setupScrollAnimation() {
    const hiddenElements = document.querySelectorAll(".hidden");
    
    const handleScroll = () => {
        hiddenElements.forEach(element => {
            const elementTop = element.getBoundingClientRect().top;
            const windowHeight = window.innerHeight;
            
            if (elementTop < windowHeight - 50) {
                element.classList.add("visible");
            } else {
                element.classList.remove("visible");
            }
        });
    };
    
    window.addEventListener("scroll", handleScroll);
    handleScroll();
}

function setupMoreButton() {
    const loadMoreBtn = document.getElementById("load-more");
    const moreProjects = document.querySelector(".more-projects");
    
    if (loadMoreBtn && moreProjects) {
        loadMoreBtn.addEventListener("click", function() {
            moreProjects.classList.toggle("visible");
            this.classList.toggle("active");
        });
    }
}



// ë””ë²„ê¹… í•¨ìˆ˜ ì¶”ê°€
window.debugFirebaseStructure = async function() {
    console.log('ğŸ” Firebase êµ¬ì¡° í™•ì¸...');
    
    try {
        const currentRef = database.ref('current projects');
        const pastRef = database.ref('past projects');
        
        const currentSnapshot = await currentRef.once('value');
        const pastSnapshot = await pastRef.once('value');
        
        const currentData = currentSnapshot.val();
        const pastData = pastSnapshot.val();
        
        console.log('=== í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡° ===');
        if (currentData) {
            Object.keys(currentData).forEach(key => {
                console.log(`í‚¤: ${key}`, currentData[key].name || 'ì´ë¦„ ì—†ìŒ');
            });
        }
        
        console.log('\n=== ê³¼ê±° í”„ë¡œì íŠ¸ êµ¬ì¡° ===');
        if (pastData) {
            Object.keys(pastData).forEach(key => {
                console.log(`í‚¤: ${key}`, pastData[key].name || 'ì´ë¦„ ì—†ìŒ');
            });
        }
        
    } catch (error) {
        console.error('êµ¬ì¡° í™•ì¸ ì‹¤íŒ¨:', error);
    }
};


function setupPositionSelector() {
    const insertPosition = document.getElementById('insertPosition');
    const specificPositionGroup = document.getElementById('specificPositionGroup');
    
    if (insertPosition) {
        insertPosition.addEventListener('change', function() {
            if (this.value === 'specific') {
                specificPositionGroup.style.display = 'block';
                updatePositionOptions();
            } else {
                specificPositionGroup.style.display = 'none';
            }
        });
    }
}

async function updatePositionOptions() {
    const projectType = document.getElementById('projectType').value;
    const specificPositionInput = document.getElementById('specificPosition');
    
    try {
        const ref = database.ref(projectType === 'current' ? 'current projects' : 'past projects');
        const snapshot = await ref.once('value');
        const data = snapshot.val() || {};
        
        const count = Object.keys(data).length;
        specificPositionInput.setAttribute('max', count);
        specificPositionInput.setAttribute('placeholder', `0ë¶€í„° ${count}ê¹Œì§€ (ì´ ${count + 1}ê°œ ìœ„ì¹˜)`);
        
    } catch (error) {
        console.error('ìœ„ì¹˜ ì˜µì…˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
    }
}


// ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ
window.deleteProject = deleteProject;
window.openModal = openModal;
window.closeModal = closeModal;

// ë””ë²„ê¹… í•¨ìˆ˜
window.debugData = function() {
    console.log('í˜„ì¬ ìƒíƒœ:');
    console.log('- currentUser:', currentUser);
    console.log('- deleteMode:', deleteMode);
    console.log('- database:', database);
    loadProjectsFromRealtimeDB();
};

console.log('ğŸ¯ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
</script>



</body>
</html>
